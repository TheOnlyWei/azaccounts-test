# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  name: Default

steps:

- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
      New-Item -Path "$(Build.SourcesDirectory)" -Name "az-new" -ItemType "directory"
      $webClient = new-object system.net.webclient
      $webClient.DownloadFile("https://modulestorage.blob.bellevue.azurestack.corp.microsoft.com/azaccountscontainer/Az.Accounts.2.1.2.nupkg", "$(Build.SourcesDirectory)\az-new\Az.Accounts.2.1.2.nupkg")
      $parameters = @{
        Name = "az-new"
        SourceLocation = "$(Build.SourcesDirectory)\az-new\"
        PublishLocation = "$(Build.SourcesDirectory)\az-new\"
        InstallationPolicy = 'Trusted'
      }
      Register-PSRepository @parameters
      Install-Module Az.Accounts -Repository az-new -Force

- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: 'ls'
